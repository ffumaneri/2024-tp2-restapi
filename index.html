<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Autos</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>Gestor de Autos</h1>

    <h2>Agregar Auto</h2>
    <form id="add-auto-form">
        <input type="number" id="add-id" placeholder="ID" required>
        <input type="text" id="add-marca" placeholder="Marca" required>
        <input type="text" id="add-modelo" placeholder="Modelo" required>
        <input type="text" id="add-año" placeholder="Año" required>
        <input type="text" id="add-puertas" placeholder="Puertas" required>
        <button type="submit">Agregar Auto</button>
    </form>

    <h2>Modificar Auto</h2>
    <form id="update-auto-form">
        <input type="number" id="update-id" placeholder="ID del auto a modificar" required>
        <input type="text" id="update-marca" placeholder="Ingrese Marca" required>
        <input type="text" id="update-modelo" placeholder="Ingrese Modelo" required>
        <input type="text" id="update-año" placeholder="Ingrese Año" required>
        <input type="text" id="update-puertas" placeholder="Ingrese Puertas" required>
        <button type="submit">Modificar Auto</button>
    </form>

    <h2>Ver Auto por ID</h2>
    <form id="view-auto-by-id-form">
        <input type="number" id="view-auto-id" placeholder="ID del auto" required>
        <button type="submit">Ver Auto</button>
    </form>

    <h2>Lista de autos</h2>
    <form id="view-autos-form">
        <button id="view-autos-button" type="button">Ver Lista de Autos</button>
    </form>

    <div id="auto-details"></div>

    <h2>Autos Disponibles</h2>
    <table id="autos-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Año</th>
                <th>Puertas</th>
                <th> </th>
            </tr>
        </thead>
        <tbody>
            <!-- Los autos se agregarán aquí dinámicamente -->
        </tbody>
    </table>

    <script>
        // Funciones para manejar las interacciones (sin cambios)
        document.getElementById('add-auto-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('add-id').value;
            const marca = document.getElementById('add-marca').value;
            const modelo = document.getElementById('add-modelo').value;
            const año = document.getElementById('add-año').value;
            const puertas = document.getElementById('add-puertas').value;
            const nuevoAuto = { id: parseInt(id), marca: marca, modelo: modelo, año: año, puertas: puertas};

            document.getElementById('add-id').value = "";
            document.getElementById('add-marca').value = "";
            document.getElementById('add-modelo').value = "";
            document.getElementById('add-año').value = "";
            document.getElementById('add-puertas').value = "";


            fetch('http://localhost:8000/autos/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(nuevoAuto),
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(errorData => {
                        throw new Error(errorData.detail || 'Error al crear el auto');
                    });
                }
                return response.json();
            })
            .then(autoCreado => {
                console.log('Auto creado:', autoCreado);
                document.getElementById('view-autos-button').click();
            })
            .catch(error => {
                mensaje = "Ya existe un auto con ese identificador.";
                console.error('Error:', mensaje);
            });
        });

        document.getElementById('view-autos-button').addEventListener('click', function() {
            fetch('http://localhost:8000/autos/')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Error al obtener la lista de autos');
                    }
                })
                .then(autos => {
                    const tableBody = document.querySelector('#autos-table tbody');
                    tableBody.innerHTML = '';
                    autos.forEach(auto => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${auto.id}</td>
                            <td>${auto.marca}</td>
                            <td>${auto.modelo}</td>
                            <td>${auto.año}</td>
                            <td>${auto.puertas}</td>
                            <td><button class="delete-button" data-id="${auto.id}">Eliminar</button></td>
                        `;
                        tableBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        document.getElementById('update-auto-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const autoId = document.getElementById('update-id').value;
            const nuevaMarca = document.getElementById('update-marca').value;
            const nuevoModelo = document.getElementById('update-modelo').value;
            const nuevoAño = document.getElementById('update-año').value;
            const nuevasPuertas = document.getElementById('update-puertas').value;
            const updatedAuto = { id: parseInt(autoId), marca: nuevaMarca, modelo: nuevoModelo, año: nuevoAño, puertas: nuevasPuertas };
            document.getElementById('update-id').value = "";
            document.getElementById('update-marca').value = "";
            document.getElementById('update-modelo').value = "";
            document.getElementById('update-año').value = "";
            document.getElementById('update-puertas').value = "";
            fetch(`http://localhost:8000/autos/${autoId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedAuto)
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Error al modificar el auto');
                }
            })
            .then(autoModificado => {
                console.log('Auto modificado:', autoModificado);
                document.getElementById('view-autos-button').click();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        document.getElementById('view-auto-by-id-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const autoId = document.getElementById('view-auto-id').value;
            document.getElementById('view-auto-id').value = "";
            fetch(`http://localhost:8000/autos/${autoId}`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Error al obtener el auto');
                    }
                })
                .then(auto => {
                    const autoDetailsDiv = document.getElementById('auto-details');
                    if (auto.error) {
                        autoDetailsDiv.innerHTML = `<p>${auto.error}</p>`;
                    } else {
                        autoDetailsDiv.innerHTML = `
                            <p>ID: ${auto.id}</p>
                            <p>Marca: ${auto.marca}</p>
                            <p>Modelo: ${auto.modelo}</p>
                            <p>Año: ${auto.año}</p>
                            <p>Puertas: ${auto.puertas}</p>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        document.getElementById('autos-table').addEventListener('click', function(event) {
            if (event.target.classList.contains('delete-button')) {
                const autoId = event.target.getAttribute('data-id');
                event.target.getAttribute('data-id').value = "";
                fetch(`http://localhost:8000/autos/${autoId}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        console.log(`Auto con ID ${autoId} eliminado.`);
                        document.getElementById('view-autos-button').click();
                    } else {
                        throw new Error('Error al eliminar el auto');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        });
    </script>
</body>
</html>
